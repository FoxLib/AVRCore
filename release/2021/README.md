# AVR Machine

Объем памяти составляет в целом 308Кб встроенной памяти, SDRAM 64 мб.
Поддерживается SDCard по протоколу SPI.

* Память программ: до 64k
* Общая память: 64k
* Для доступа из программы: 168k
* Зарезервировано памяти: 12k

# Список портов

Порты размаплены специально для того, чтобы не вызывать несовместимости
между Arduino UNO. Эти порты не используются и зарезервированы для
Atmega328PU.

```
20 RW MEMBANK       Текущий банк памяти (F000h-FFFFh)
--------------------
21 R  KEYB          Последняя нажатая клавиша на клавиатуре
21 W  INTRTMR       Количество миллисекунд между вызовами таймера IRQ#1
--------------------
22 R  STATUS        Бит 0: FlipFlop-статус нажатия клавиш на клавиатуре
                    Бит 1: SPI Busy, если 1-устройство занято
                    Бит 2: DRAM Busy, если 1-устройсто занято
                    Бит 3: DRAM WE статус
22 W  COMMAND       Бит 3: =1 Запись в память SDRAM
--------------------
2C RW CURSORX       X координата курсора (0..79)
2D RW CURSORY       Y координата курсора (0..24)
--------------------
2E R  TIMERL        Значение миллисекундного таймера  7:0
2F R  TIMERH        Значение миллисекундного таймера 15:8
--------------------
30 RW SDRAM0A       Адрес SDRAM  7: 0
31 RW SDRAM1A       Адрес SDRAM 15: 8
32 RW SDRAM2A       Адрес SDRAM 23:16
33 RW SDRAM3A       Адрес SDRAM 31:24
34 RW SDRAMDATA     Чтение из запись байта в память SDRAM
--------------------
38 RW VIDEOMODE     Видеорежим
--------------------
39 RW SPIDATA       Данные с SDCARD
3A RW SPICMD        Команда на SPI:
                    Биты 0..1:

                    00: INIT (Инициализация 80 тактов)
                    01: RDWR (Записать и прочесть данные)
                    10: CS=0 (Включить чип)
                    11: CS=1 (Отключить)

                    Бит  7: Защелка регистра CMD (позитивный фронт)
```

# Список видеорежимов
```
ID Разрешение Банк  Размер Описание
00 80x25      02-03 8к     Классический текстовый режим IBM
01 640x400x4  20-3F 128k   16 цветов
02 320x200x8  20-2F 64k    256 цветов #0
03 320x200x8  30-3F 64k    256 цветов #1
```

# Карта памяти

Память меняется через банки памяти, которые отображатся на F000h-FFFFh

```
0000h-EFFFh Общая память (программа и стек)
F000h-FFFFh Банки памяти
```

Назначение банков памяти:

```
00      4k   Верхняя страница общей памяти
02      4k   Текстовый видеорежим 0 (IBM)
03      4k   Знакогенератор видеорежима
10-17   32k  Дополнительная общая память
20-3F   128k Видеопамять, общая память (128k)
```

В банке 0 можно хранить, к примеру, шрифты 4x8, 8x8 или 8x16 для графических
видеорежимов.
